<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–®–∞—Ä –°—É–¥—å–±—ã: Pro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover" />
  
  <!-- VK Bridge -->
  <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>

  <style>
    :root {
      --primary: #4fc3f7;
      --glass: rgba(255, 255, 255, 0.12);
      --glass-border: rgba(255, 255, 255, 0.15);
      --text-glow: 0 0 10px rgba(79, 195, 247, 0.5);
    }

    html, body { -webkit-tap-highlight-color: transparent; }
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      margin: 0;
      background: radial-gradient(circle at center, #111118, #000);
      font-family: 'Arial', sans-serif;
      color: white;
      user-select: none;
      overflow: hidden;
    }

    /* --- ICONS (SVG) --- */
    .icon {
      width: 24px;
      height: 24px;
      stroke: white;
      stroke-width: 2;
      fill: none;
      stroke-linecap: round;
      stroke-linejoin: round;
      filter: drop-shadow(0 0 5px rgba(255,255,255,0.3));
    }
    .icon-sm { width: 18px; height: 18px; }

    /* --- TOP BAR --- */
    .top-bar {
      position: absolute;
      top: 15px;
      width: 90%;
      display: flex;
      justify-content: space-between;
      z-index: 10;
    }

    .icon-btn {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 14px;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      backdrop-filter: blur(10px);
      transition: transform 0.2s, background 0.2s;
    }
    .icon-btn:active { transform: scale(0.92); background: rgba(255,255,255,0.2); }

    .xp-counter {
      background: var(--glass);
      padding: 0 16px;
      border-radius: 20px;
      font-size: 15px;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(10px);
    }

    /* --- BACKGROUND STARS --- */
    .stars { position: absolute; inset: 0; overflow: hidden; z-index: 0; pointer-events: none;}
    .star {
      position: absolute; width: 2px; height: 2px; background: white; border-radius: 50%;
      opacity: 0.6; animation: twinkle 3s infinite alternate;
    }
    @keyframes twinkle { from { opacity: 0.2; } to { opacity: 1; } }

    /* --- BALL --- */
    .ball-container {
      position: relative;
      margin-top: auto;
      margin-bottom: auto;
      z-index: 1;
      transition: filter 0.5s ease;
    }
    .ball {
      width: 280px;
      height: 280px;
      background: url('8-Ball.png') no-repeat center/cover;
      animation: sway 6s ease-in-out infinite;
      cursor: pointer;
      transition: transform 0.1s;
      border-radius: 50%;
      box-shadow: 0 0 60px rgba(0,0,0,0.6);
    }
    .ball:active { transform: scale(0.97); }
    .ball.vibrate { animation: vibrate 0.4s linear 2; }

    /* Skins Filters */
    .skin-default { filter: none; }
    .skin-red { filter: hue-rotate(140deg) saturate(1.5) contrast(1.1); }
    .skin-gold { filter: sepia(1) hue-rotate(10deg) saturate(2) brightness(1.1); }
    .skin-neon { filter: invert(1) hue-rotate(180deg) contrast(1.2); }
    .skin-matrix { filter: sepia(1) hue-rotate(70deg) saturate(5) contrast(1.2); }

    @keyframes sway {
      0%, 100% { transform: translateY(0) rotate(-2deg); }
      50% { transform: translateY(-12px) rotate(2deg); }
    }
    @keyframes vibrate {
      0% { transform: translate(0); }
      20% { transform: translate(-3px, 3px); }
      40% { transform: translate(-3px, -3px); }
      60% { transform: translate(3px, 3px); }
      80% { transform: translate(3px, -3px); }
      100% { transform: translate(0); }
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-6px); }
      75% { transform: translateX(6px); }
    }
    .shake-input { animation: shake 0.3s ease-in-out; border-color: #ff5252 !important; }

    /* --- ANSWER --- */
    .answer {
      position: absolute;
      top: 54%; left: 50%;
      transform: translate(-50%, -50%);
      width: 140px; height: 90px;
      display: flex; align-items: center; justify-content: center;
      text-align: center;
      font-size: 20px;
      opacity: 0;
      transition: opacity 0.5s ease;
      background: linear-gradient(180deg, #fff, #4fc3f7);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      pointer-events: none;
      filter: drop-shadow(0 0 8px rgba(79,195,247,0.6));
      line-height: 1.1;
      font-weight: bold;
    }
    .answer.show { opacity: 1; }

    /* --- CONTROLS --- */
    .question-box {
      margin-bottom: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 5;
      width: 100%;
    }
    .question-input {
      padding: 14px 24px;
      border-radius: 30px;
      border: 1px solid var(--glass-border);
      background: var(--glass);
      color: white;
      outline: none;
      font-size: 16px;
      width: 260px;
      text-align: center;
      backdrop-filter: blur(15px);
      transition: all 0.3s;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .question-input:focus { border-color: var(--primary); background: rgba(255,255,255,0.2); }
    .question-input::placeholder { color: rgba(255,255,255,0.5); }

    .action-buttons {
      margin-top: 20px;
      display: flex;
      gap: 12px;
    }
    .btn {
      padding: 10px 20px;
      border-radius: 18px;
      border: none;
      background: linear-gradient(135deg, #2196F3, #00BCD4);
      color: white;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 15px rgba(33, 203, 243, 0.3);
      transition: transform 0.1s;
    }
    .btn:active { transform: scale(0.96); }
    .btn-secondary { background: linear-gradient(135deg, #FF9800, #F44336); box-shadow: 0 4px 15px rgba(255, 87, 34, 0.3); }
    .btn-purple { background: linear-gradient(135deg, #7E57C2, #AB47BC); box-shadow: 0 4px 15px rgba(156, 39, 176, 0.3); }

    /* --- MODALS --- */
    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(8px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 100;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .modal-overlay.open { display: flex; opacity: 1; }
    
    .modal {
      background: #181824;
      padding: 24px;
      border-radius: 24px;
      width: 310px;
      text-align: center;
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 20px 50px rgba(0,0,0,0.7);
    }
    .modal h2 { margin: 0 0 20px; font-size: 22px; color: white; display:flex; align-items:center; justify-content:center; gap:10px; }
    
    .grid-options { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .option-card {
      background: rgba(255,255,255,0.05);
      padding: 12px;
      border-radius: 16px;
      cursor: pointer;
      border: 1px solid transparent;
      transition: 0.2s;
    }
    .option-card.active { border-color: var(--primary); background: rgba(79, 195, 247, 0.15); }
    .option-card.locked { opacity: 0.5; pointer-events: none; }

    .btn-close {
      margin-top: 20px; width: 100%; padding: 12px;
      background: #2c2c3a; color: white; border: none; border-radius: 12px; font-size:16px;
    }

    .toast {
      position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%);
      background: rgba(20, 20, 20, 0.95); padding: 12px 24px; border-radius: 30px;
      color: white; font-size: 14px; pointer-events: none; opacity: 0; transition: opacity 0.3s; z-index: 200;
      border: 1px solid rgba(255,255,255,0.1);
      display: flex; align-items: center; gap: 8px;
    }
    .toast.show { opacity: 1; }
  </style>
</head>
<body>

  <!-- Top Interface -->
  <div class="top-bar">
    <div class="xp-counter">
      <!-- Star Icon -->
      <svg class="icon icon-sm" viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
      <span id="xpDisplay">0</span> XP
    </div>
    <div style="display:flex; gap:10px;">
        <!-- Shop Icon -->
        <button class="icon-btn" onclick="openModal('shopModal')">
          <svg class="icon" viewBox="0 0 24 24"><path d="M12 19l7-7 3 3-7 7-3-3z"></path><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path><path d="M2 2l7.586 7.586"></path><circle cx="11" cy="11" r="2"></circle></svg>
        </button>
        <!-- Settings Icon -->
        <button class="icon-btn" onclick="openModal('settingsModal')">
          <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
        </button>
    </div>
  </div>

  <div class="stars"></div>

  <!-- Game Area -->
  <div class="ball-container" id="ballContainer">
    <div class="ball" id="magicBall">
      <div id="answer" class="answer"></div>
    </div>
  </div>

  <!-- Controls -->
  <div class="question-box">
    <input id="questionInput" class="question-input" type="text" placeholder="–ù–∞–ø–∏—à–∏ –≤–æ–ø—Ä–æ—Å..." autocomplete="off"/>
    
    <div class="action-buttons">
      <button class="btn btn-secondary" onclick="openDaily()">
        <!-- Calendar Icon -->
        <svg class="icon icon-sm" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
        –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ
      </button>
      <button class="btn btn-purple" onclick="openPrank()">
        <!-- Mask/Ghost Icon -->
        <svg class="icon icon-sm" viewBox="0 0 24 24"><path d="M2 22l3-3h14l3 3"></path><path d="M12 2a7 7 0 0 0-7 7c0 2 0 3 2 4.5V17a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-1a1 1 0 0 1 1-1h0a1 1 0 0 1 1 1v1a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-3.5C22 12 22 11 22 9a7 7 0 0 0-7-7z"></path><path d="M9 9h.01"></path><path d="M15 9h.01"></path></svg>
        –ü—Ä–∞–Ω–∫
      </button>
    </div>
  </div>

  <div id="toast" class="toast">
    <svg class="icon icon-sm" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
    <span id="toastMsg">–°–æ–æ–±—â–µ–Ω–∏–µ</span>
  </div>

  <!-- MODALS -->

  <!-- Settings / Modes -->
  <div id="settingsModal" class="modal-overlay">
    <div class="modal">
      <h2>
         <svg class="icon" viewBox="0 0 24 24"><smile cx="12" cy="12" r="10"></smile><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>
         –†–µ–∂–∏–º—ã
      </h2>
      <div class="grid-options" id="modesGrid">
        <div class="option-card active" onclick="setMode('normal', this)">üòê –û–±—ã—á–Ω—ã–π</div>
        <div class="option-card" onclick="setMode('sarcasm', this)">üòè –°–∞—Ä–∫–∞–∑–º</div>
        <div class="option-card" onclick="setMode('love', this)">‚ù§Ô∏è –õ—é–±–æ–≤—å</div>
        <div class="option-card" onclick="setMode('meme', this)">ü§™ –ú–µ–º—ã</div>
      </div>
      <button class="btn-close" onclick="closeModal('settingsModal')">–ì–æ—Ç–æ–≤–æ</button>
    </div>
  </div>

  <!-- Shop -->
  <div id="shopModal" class="modal-overlay">
    <div class="modal">
      <h2>
        <svg class="icon" viewBox="0 0 24 24"><path d="M12 2l9 4.9V17L12 22 3 17V6.9z"></path></svg>
        –ú–∞–≥–∞–∑–∏–Ω
      </h2>
      <p style="font-size:13px; opacity:0.6; margin-bottom:15px;">–ö–æ–ø–∏ XP –∑–∞ –≤–æ–ø—Ä–æ—Å—ã</p>
      <div class="grid-options" id="skinsGrid">
        <!-- JS Generated -->
      </div>
      <button class="btn-close" onclick="closeModal('shopModal')">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <!-- Prank -->
  <div id="prankModal" class="modal-overlay">
    <div class="modal">
      <h2>
          <svg class="icon" viewBox="0 0 24 24"><path d="M2 12h20"></path><path d="M7 12v-2a5 5 0 0 1 10 0v2"></path><path d="M12 12v6"></path></svg>
          –†–æ–∑—ã–≥—Ä—ã—à
      </h2>
      <p style="font-size:14px; margin-bottom:10px; color:#aaa;">–í–ø–∏—à–∏ –æ—Ç–≤–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ç–æ—á–Ω–æ –≤—ã–ø–∞–¥–µ—Ç:</p>
      <input id="prankInput" class="question-input" style="width: 85%; margin-bottom:15px;" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–æ–Ω–µ—á–Ω–æ –Ω–µ—Ç">
      <button class="btn" style="width:100%; justify-content:center;" onclick="createPrankLink()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
      <button class="btn-close" style="margin-top:10px; background:transparent; border:1px solid #444;" onclick="closeModal('prankModal')">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>

  <!-- Daily -->
  <div id="dailyModal" class="modal-overlay">
    <div class="modal">
      <h2>
          <svg class="icon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
          –°–æ–≤–µ—Ç –¥–Ω—è
      </h2>
      <div style="margin: 25px 0; font-size: 17px; font-weight: bold; color: #4fc3f7; min-height: 50px; display: flex; align-items: center; justify-content: center; line-height:1.4;">
          <span id="dailyText">...</span>
      </div>
      <button class="btn" style="width:100%; justify-content:center;" onclick="closeDaily()">–ó–∞–±—Ä–∞—Ç—å (+10 XP)</button>
    </div>
  </div>

  <script>
    // --- 1. –†–ê–°–®–ò–†–ï–ù–ù–´–ï –û–¢–í–ï–¢–´ ---
    const MODES = {
        normal: [
            "–ë–µ—Å—Å–ø–æ—Ä–Ω–æ", "–ü—Ä–µ–¥—Ä–µ—à–µ–Ω–æ", "–ù–∏–∫–∞–∫–∏—Ö —Å–æ–º–Ω–µ–Ω–∏–π", "–û–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ –¥–∞", "–ú–æ–∂–µ—à—å –±—ã—Ç—å —É–≤–µ—Ä–µ–Ω",
            "–ú–Ω–µ –∫–∞–∂–µ—Ç—Å—è ‚Äî –¥–∞", "–í–µ—Ä–æ—è—Ç–Ω–µ–µ –≤—Å–µ–≥–æ", "–ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã —Ö–æ—Ä–æ—à–∏–µ", "–ó–Ω–∞–∫–∏ –≥–æ–≤–æ—Ä—è—Ç ‚Äî –¥–∞", "–î–∞",
            "–ü–æ–∫–∞ –Ω–µ —è—Å–Ω–æ", "–°–ø—Ä–æ—Å–∏ –ø–æ–∑–∂–µ", "–õ—É—á—à–µ –Ω–µ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å", "–°–µ–π—á–∞—Å –Ω–µ–ª—å–∑—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å", "–°–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É–π—Å—è –∏ —Å–ø—Ä–æ—Å–∏",
            "–î–∞–∂–µ –Ω–µ –¥—É–º–∞–π", "–ú–æ–π –æ—Ç–≤–µ—Ç ‚Äî –Ω–µ—Ç", "–ü–æ –º–æ–∏–º –¥–∞–Ω–Ω—ã–º ‚Äî –Ω–µ—Ç", "–ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã –Ω–µ –æ—á–µ–Ω—å", "–í–µ—Å—å–º–∞ —Å–æ–º–Ω–∏—Ç–µ–ª—å–Ω–æ"
        ],
        sarcasm: [
            "–¢—ã —Å–µ—Ä—å–µ–∑–Ω–æ?", "–ó–∞–≥—É–≥–ª–∏, –Ω–µ –ø–æ–∑–æ—Ä—å—Å—è", "–û–π, –≤—Å—ë", "–î–∞–∂–µ –Ω–µ –Ω–∞–¥–µ–π—Å—è", "–°–ø—Ä–æ—Å–∏ —É –º–∞–º—ã",
            "404 –û—Ç–≤–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω", "–ú–Ω–µ –±—ã —Ç–≤–æ–∏ –ø—Ä–æ–±–ª–µ–º—ã", "–ê –≥–æ–ª–æ–≤—É —Ç—ã –Ω–µ –∑–∞–±—ã–ª?", "–ó–≤–µ–∑–¥—ã –≤ —à–æ–∫–µ –æ—Ç –≤–æ–ø—Ä–æ—Å–∞",
            "–≠—Ç–æ —Ñ–∏–∞—Å–∫–æ, –±—Ä–∞—Ç–∞–Ω", "–Ø —à–∞—Ä, –∞ –Ω–µ –ø—Å–∏—Ö–æ–ª–æ–≥", "–ü–æ–ø—Ä–æ–±—É–π –≤–∫–ª—é—á–∏—Ç—å –º–æ–∑–≥", "–ù–µ —Å–µ–≥–æ–¥–Ω—è",
            "–¢–≤–æ—è –Ω–∞–∏–≤–Ω–æ—Å—Ç—å —É–º–∏–ª—è–µ—Ç", "–í—Ä—è–¥ –ª–∏, –Ω–æ –º–µ—á—Ç–∞—Ç—å –Ω–µ –≤—Ä–µ–¥–Ω–æ", "–ê–≥–∞, —Ä–∞–∑–±–µ–∂–∞–ª—Å—è"
        ],
        love: [
            "–≠—Ç–æ –ª—é–±–æ–≤—å!", "–¢–≤–æ—è –ø–æ–ª–æ–≤–∏–Ω–∫–∞ —Ä—è–¥–æ–º", "–ü–æ–∑–≤–æ–Ω–∏ —Å–µ–π—á–∞—Å –∂–µ", "–í–∞—Å –∂–¥–µ—Ç —Å–≤–∏–¥–∞–Ω–∏–µ", "–≠—Ç–æ —Å—É–¥—å–±–∞!",
            "–ó–∞–±—É–¥—å –∏ –æ—Ç–ø—É—Å—Ç–∏", "–í—Å—ë —Å–ª–æ–∂–Ω–æ", "–°–ª—É—à–∞–π —Å–≤–æ–µ —Å–µ—Ä–¥—Ü–µ", "–õ—é–±–æ–≤—å –∑–ª–∞...", "–°–∫–æ—Ä–æ –≤—Å—Ç—Ä–µ—Ç–∏—à—å —Å—á–∞—Å—Ç—å–µ",
            "–ù–µ —Ç–æ—Ä–æ–ø–∏ —Å–æ–±—ã—Ç–∏—è", "–¢—ã –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—à—å –ª—É—á—à–µ–≥–æ", "–°—Ç—Ä–∞—Å—Ç—å —É—Ç–∏—Ö–Ω–µ—Ç", "–í–∑–∞–∏–º–Ω–æ—Å—Ç—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞",
            "–û—Å—Ç–æ—Ä–æ–∂–Ω–µ–µ —Å —á—É–≤—Å—Ç–≤–∞–º–∏"
        ],
        meme: [
            "Press F", "Stonks!", "Impossible", "No God Please No", "This is fine", "Shut up and take my money",
            "Run!", "It was at this moment he knew...", "Why are you running?", "Wait, that's illegal",
            "Doge approves", "Woman yelling at cat", "Is this a pigeon?", "Change my mind", "Sad Keanu"
        ]
    };

    // –û—Ç–≤–µ—Ç—ã –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤–æ–ø—Ä–æ—Å
    const REPEAT_ANSWERS = [
        "–Ø —É–∂–µ –æ—Ç–≤–µ—á–∞–ª!", "–ù–µ –ø–æ–≤—Ç–æ—Ä—è–π—Å—è", "–û—Ç–≤–µ—Ç —Ç–æ—Ç –∂–µ", "–°–∫–ª–µ—Ä–æ–∑?", 
        "–°–ø—Ä–æ—Å–∏ —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ", "–ù–µ —Å–ø–∞–º—å", "–û–¥–∏–Ω —Ä–∞–∑ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ"
    ];

    const SKINS = [
        { id: 'default', name: '–ö–ª–∞—Å—Å–∏–∫–∞', price: 0, class: 'skin-default' },
        { id: 'red', name: '–î–µ–º–æ–Ω', price: 20, class: 'skin-red' },
        { id: 'gold', name: '–ú–∞–∂–æ—Ä', price: 50, class: 'skin-gold' },
        { id: 'neon', name: '–ö–∏–±–µ—Ä', price: 100, class: 'skin-neon' },
        { id: 'matrix', name: '–•–∞–∫–µ—Ä', price: 200, class: 'skin-matrix' }
    ];

    let state = {
        xp: 0,
        currentSkin: 'default',
        currentMode: 'normal',
        lastDaily: null
    };

    let prankAnswer = null;
    let isAnimating = false;
    let attemptCounter = 0;
    
    // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
    let lastQuestion = "";

    // --- INIT ---
    const ball = document.getElementById('magicBall');
    const ballContainer = document.getElementById('ballContainer');
    const answerEl = document.getElementById('answer');
    const questionInput = document.getElementById('questionInput');
    const xpDisplay = document.getElementById('xpDisplay');

    window.addEventListener('load', () => {
        vkBridge.send('VKWebAppInit');
        loadState();
        checkPrankUrl();
        renderSkins();
        // showAd(); // –ú–æ–∂–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è —Ä–µ–∫–ª–∞–º—ã –ø—Ä–∏ –≤—Ö–æ–¥–µ
    });

    // --- –õ–û–ì–ò–ö–ê ---

    function showAnswer() {
        if (isAnimating) return;
        
        const inputVal = questionInput.value.trim().toLowerCase();
        
        // 1. –ü–£–°–¢–û–ô –í–û–ü–†–û–°
        if (inputVal === "") {
            showToast("–°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏ –≤–æ–ø—Ä–æ—Å!");
            questionInput.classList.add('shake-input');
            setTimeout(() => questionInput.classList.remove('shake-input'), 400);
            questionInput.focus();
            return; 
        }

        // 2. –ü–†–û–í–ï–†–ö–ê –ù–ê –ü–û–í–¢–û–† (–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞)
        // –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø—Ä–∞–Ω–∫ –∏ –≤–æ–ø—Ä–æ—Å —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º
        if (!prankAnswer && inputVal === lastQuestion) {
            // –í—ã–¥–∞–µ–º –æ—Ç–∫–∞–∑, –Ω–æ –Ω–µ —Ç—Ä—è—Å–µ–º —à–∞—Ä —Å–∏–ª—å–Ω–æ
            showRefusal();
            return;
        }

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π
        lastQuestion = inputVal;

        // –í–∏–±—Ä–∞—Ü–∏—è
        vkBridge.send("VKWebAppTapticImpactOccurred", {"style": "heavy"});
        isAnimating = true;
        questionInput.blur();
        
        let finalAnswer = "";
        
        // –ü–†–û–í–ï–†–ö–ê –ù–ê –ü–†–ê–ù–ö
        if (prankAnswer) {
            finalAnswer = prankAnswer;
            prankAnswer = null;
            showToast("–í–∞—Å —Ä–∞–∑—ã–≥—Ä–∞–ª–∏! ü§°");
            window.history.replaceState({}, document.title, window.location.pathname);
        } 
        // –ü–ê–°–•–ê–õ–ö–ò
        else if (inputVal.includes("–¥—É—Ä–æ–≤")) {
            finalAnswer = "–í–µ—Ä–Ω–∏ —Å—Ç–µ–Ω—É!";
        } else if (inputVal.includes("–≤–∫–æ–Ω—Ç–∞–∫—Ç–µ") || inputVal.includes("vk")) {
            finalAnswer = "–¢–æ–ø —Å–æ—Ü—Å–µ—Ç—å üíô";
        } 
        // –û–ë–´–ß–ù–´–ô –†–ï–ñ–ò–ú
        else {
            const answers = MODES[state.currentMode];
            finalAnswer = answers[Math.floor(Math.random() * answers.length)];
        }

        // –†–µ–∫–ª–∞–º–∞
        attemptCounter++;
        if (attemptCounter % 4 === 0) showAd();

        // –ê–Ω–∏–º–∞—Ü–∏—è
        animateBall(finalAnswer, true); // true = –¥–∞–µ–º –æ–ø—ã—Ç
    }

    // –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫–∞–∑–∞ –æ—Ç–≤–µ—á–∞—Ç—å (–±–µ–∑ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –æ–ø—ã—Ç–∞ –∏ —Ä–µ–∫–ª–∞–º—ã)
    function showRefusal() {
        if (isAnimating) return;
        isAnimating = true;
        
        // –õ–µ–≥–∫–∞—è –≤–∏–±—Ä–∞—Ü–∏—è
        vkBridge.send("VKWebAppTapticImpactOccurred", {"style": "light"});
        questionInput.blur();

        const refusalText = REPEAT_ANSWERS[Math.floor(Math.random() * REPEAT_ANSWERS.length)];
        animateBall(refusalText, false); // false = –±–µ–∑ –æ–ø—ã—Ç–∞
    }

    function animateBall(text, giveXp) {
        answerEl.classList.remove('show');
        ball.classList.add('vibrate');

        setTimeout(() => {
            ball.classList.remove('vibrate');
            
            answerEl.textContent = text;
            fitText(answerEl);
            answerEl.classList.add('show');
            
            if (giveXp) addXP(1);

            isAnimating = false;
        }, 800);
    }

    function fitText(el) {
        let fontSize = 20;
        el.style.fontSize = fontSize + 'px';
        while ((el.scrollHeight > el.clientHeight || el.scrollWidth > el.clientWidth) && fontSize > 10) {
            fontSize--;
            el.style.fontSize = fontSize + 'px';
        }
    }

    function showAd() {
        vkBridge.send('VKWebAppShowNativeAds', { ad_format: 'interstitial' })
            .catch(e => console.log(e));
    }

    // --- –ü–†–ê–ù–ö ---
    function openPrank() { openModal('prankModal'); }

    function createPrankLink() {
        const text = document.getElementById('prankInput').value.trim();
        if (!text) return showToast("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞!");

        const hash = `#prank=${encodeURIComponent(text)}`;
        let appId = getAppIdFromUrl() || "";
        let baseUrl = "https://vk.com/app" + appId;
        if (!appId) baseUrl = location.href.split('#')[0];
        
        const link = baseUrl + hash; 

        vkBridge.send("VKWebAppCopyTextToClipboard", { "text": link })
            .then(() => showToast("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!"))
            .catch(() => {
                navigator.clipboard.writeText(link);
                showToast("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
            });
            
        closeModal('prankModal');
    }

    function checkPrankUrl() {
        const hash = window.location.hash;
        if (hash.startsWith('#prank=')) {
            const encodedText = hash.split('#prank=')[1];
            try {
                prankAnswer = decodeURIComponent(encodedText);
                questionInput.placeholder = "–®–∞—Ä –∑–Ω–∞–µ—Ç –ø—Ä–∞–≤–¥—É...";
            } catch(e) {}
        }
    }
    
    function getAppIdFromUrl() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('vk_app_id'); 
    }

    // --- DAILY ---
    function openDaily() {
        const today = new Date().toDateString();
        if (state.lastDaily === today) {
            showToast("–ü—Ä–∏—Ö–æ–¥–∏ –∑–∞–≤—Ç—Ä–∞! üåô");
            return;
        }

        const dailyWisdom = [
            "–°–µ–≥–æ–¥–Ω—è —Ç–≤–æ–π –¥–µ–Ω—å!", "–ë—É–¥—å –æ—Å—Ç–æ—Ä–æ–∂–µ–Ω —Å –¥–µ–Ω—å–≥–∞–º–∏.", "–¢–µ–±—è –∂–¥–µ—Ç —Å—é—Ä–ø—Ä–∏–∑.",
            "–£–ª—ã–±–Ω–∏—Å—å –ø—Ä–æ—Ö–æ–∂–µ–º—É.", "–í—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å!", "–û—Ç–¥–æ—Ö–Ω–∏ —Å–µ–≥–æ–¥–Ω—è.", "–ü–æ–∑–≤–æ–Ω–∏ –±–ª–∏–∑–∫–∏–º.",
            "–£–¥–∞—á–∞ –Ω–∞ —Ç–≤–æ–µ–π —Å—Ç–æ—Ä–æ–Ω–µ.", "–ò–∑–±–µ–≥–∞–π —Å–ø–æ—Ä–æ–≤.", "–ö—É–ø–∏ –ª–æ—Ç–µ—Ä–µ–π–Ω—ã–π –±–∏–ª–µ—Ç."
        ];
        const advice = dailyWisdom[Math.floor(Math.random() * dailyWisdom.length)];
        
        document.getElementById('dailyText').textContent = advice;
        openModal('dailyModal');
        
        state.lastDaily = today;
        saveState();
    }

    function closeDaily() {
        addXP(10);
        showToast("+10 XP");
        closeModal('dailyModal');
    }

    // --- SYSTEM ---
    function addXP(amount) {
        state.xp += amount;
        xpDisplay.textContent = state.xp;
        saveState();
        renderSkins();
    }

    function renderSkins() {
        const grid = document.getElementById('skinsGrid');
        grid.innerHTML = '';
        
        SKINS.forEach(skin => {
            const el = document.createElement('div');
            el.className = 'option-card';
            const isLocked = state.xp < skin.price;
            const isActive = state.currentSkin === skin.id;
            
            if (isActive) el.classList.add('active');
            if (isLocked) el.classList.add('locked');
            
            el.innerHTML = `
                <div style="font-weight:bold">${skin.name}</div>
                <div style="font-size:12px; opacity:0.7">${skin.price} XP</div>
            `;
            
            el.onclick = () => {
                if (isLocked) {
                    showToast(`–ù—É–∂–Ω–æ ${skin.price} XP!`);
                    return;
                }
                setSkin(skin.id);
                document.querySelectorAll('#skinsGrid .option-card').forEach(c => c.classList.remove('active'));
                el.classList.add('active');
            };
            
            grid.appendChild(el);
        });
    }

    function setSkin(id) {
        state.currentSkin = id;
        const skinObj = SKINS.find(s => s.id === id);
        ballContainer.className = 'ball-container';
        if (skinObj && skinObj.class) {
            ballContainer.classList.add(skinObj.class);
        }
        saveState();
    }

    function setMode(mode, el) {
        state.currentMode = mode;
        document.querySelectorAll('#modesGrid .option-card').forEach(c => c.classList.remove('active'));
        el.classList.add('active');
        saveState();
        showToast("–†–µ–∂–∏–º –∏–∑–º–µ–Ω–µ–Ω");
    }

    function saveState() { localStorage.setItem('magicBallPro', JSON.stringify(state)); }
    function loadState() {
        const saved = localStorage.getItem('magicBallPro');
        if (saved) {
            try {
                const parsed = JSON.parse(saved);
                state = { ...state, ...parsed };
                xpDisplay.textContent = state.xp;
                setSkin(state.currentSkin);
            } catch(e) {}
        }
    }

    function openModal(id) { document.getElementById(id).classList.add('open'); }
    function closeModal(id) { document.getElementById(id).classList.remove('open'); }
    
    function showToast(msg) {
        const t = document.getElementById('toast');
        document.getElementById('toastMsg').textContent = msg;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 3000);
    }

    questionInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') showAnswer(); });
    ball.addEventListener('click', showAnswer);

    // Stars gen
    const starsContainer = document.querySelector('.stars');
    for (let i = 0; i < 60; i++) {
        const s = document.createElement('div');
        s.className = 'star';
        s.style.left = Math.random()*100 + '%';
        s.style.top = Math.random()*100 + '%';
        s.style.animationDelay = Math.random()*3 + 's';
        starsContainer.appendChild(s);
    }
  </script>
</body>
</html>
